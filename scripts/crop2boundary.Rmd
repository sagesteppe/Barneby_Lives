---
title: "crop"
author: "steppe"
date: "`r Sys.Date()`"
output: html_document
---

Many of these datasets are very large we are going to crop them to the area of analysis, and save the subsets. 


```{r library}
library(sf)
library(terra)
library(tidyverse)
source('functions.R')
```

```{r define domain of data}

bound <- data.frame(
  y = c(30, 30, 50, 50, 30), 
  x = c(-85, -125, -125, -85, -85)
) %>% 
  st_as_sf(coords = c('x', 'y'), crs = 4326) %>% 
  st_bbox() %>% 
  st_as_sfc()

bb_vals <- c(-125, -85, 30, 50)
w_illi <- ext(bb_vals)

tile_cells <- st_make_grid(
  bound,
  what = "polygons", square = T, flat_topped = F, crs = 4326,
  n = c(
  abs(round( (bb_vals[2] - bb_vals[1]) / 5, 0)), # rows
    abs(round( (bb_vals[3] - bb_vals[4]) / 5, 0))) #cols
) %>% 
  st_as_sf() %>% 
  rename(geometry = x) %>% 
  mutate(x = st_coordinates(st_centroid(.))[,1],
         y = st_coordinates(st_centroid(.))[,2], 
         .before = geometry, 
         across(c('x', 'y'), round, 1),
         cellname = paste0('n', abs(y), 'w', abs(x))
         )

tile_cellsV <- vect(tile_cells)
```

```{r subset physical variables to domain, eval = F}

mason(dirin = '../geodata_raw/geomorphons/',
      dirout = '../geodata/geomorphons/',
      grid = tile_cellsV, fnames = 'cellname')

mason(dirin = '../geodata_raw/aspect/',
      dirout = '../geodata/aspect/',
      grid = tile_cellsV, fnames = 'cellname')

mason(dirin = '../geodata_raw/slope/',
      dirout = '../geodata/slope/',
      grid = tile_cellsV, fnames = 'cellname')

```


```{r import states to crop to}
counties <- st_read('../geodata/USCounties')
st <- tigris::states() %>% select(STATEFP, STUSPS, STATE = NAME) %>% 
  filter(STUSPS %in% c('AZ', 'AK', 'CA', 'CO', 'ID', 'KS', 'NE', 'ND', 'NM', 'NV', 
                       'MN', 'MT', 'SD', 'TX', 'OK', 'OR', 'UT', 'WA', 'WY'))
```

```{r}
ggplot() + 
  geom_sf(data = st, aes(fill = STATEFP), color = NA)
```

