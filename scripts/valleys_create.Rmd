---
title: "Creating Named Valleys Dataset"
author: "Payton Lott, Gus Rytting, Reed Benkendorf"
date: "`r Sys.Date()`"
output: html_document
---

The 'Mountains Inventory version 2' dataset generated by Global Mountain Biodiversity Assessment contains a standardized naming schema for all of the worlds mountains. We are interested in developing a similar named schema for many of the valleys of Western North America. 


In order to identify drainage areas, 
USGS Watershed Boundary Dataset (WBD) was used as a source of all major watersheds [The National Map](https://apps.nationalmap.gov/downloader/#/).


```{r}
library(tidyverse)
library(sf)
library(terra)
```


```{r mountains}
mtns <- st_read('../geodata/mountains/mountains.shp', quiet = T)
mtn_bbox <- mtns %>% 
  st_transform(4269) %>% 
  st_bbox()

mtns <- st_make_valid(mtns)
```


HU 10 dataset was used as the source for watersheds wherein we would name valleys. It was cropped to the extent of the study area.


```{r load watershed dataset}

pbasin <- '../geodata_raw/watershedBoundaries/WBD_National_GPKG/WBD_National_GPKG.gpkg'
st_layers(pbasin)

hu2 <- st_read(dsn = pbasin, layer = 'WBDHU2')  %>% 
  select(HU2_NAME = name) %>% 
  st_crop(., mtn_bbox)

hu10 <- st_read(dsn = pbasin, layer = 'WBDHU10')  %>% 
  select(HU10_NAME = name) %>% 
  st_crop(., mtn_bbox) 

hu10 <- hu10[st_intersects(hu10, st_union(hu2)) %>% lengths > 0, ]

hu10 <- st_transform(hu10, 5070) %>% 
  st_simplify(dTolerance = 75) %>% 
  st_transform(4326) # around 1/9 the size of the original

hu10 <- st_make_valid(hu10)
```

```{r identify watersheds in the great basin area}

gb <- filter(hu2, HU2_NAME == 'Great Basin Region') %>% 
  st_transform(4326)

gb10 <- hu10[st_intersects(hu10, st_union(gb)) %>% lengths > 0, ]
```

```{r overlay with gb mtns}

mtns_gb <- mtns[st_intersects(mtns, st_union(gb10)) %>% lengths > 0, ]
gb10_er <- rmapshaper::ms_erase(gb10, mtns)

ggplot() + 
  geom_sf(data = gb10_er) +
  geom_sf(data = mtns_gb, fill = 'purple', alpha = 0.3)
```


```{r identify western watersheds}
west_pl <- c('California Region', 'Pacific Northwest Region', 
             'Lower Colorado Region', 'Great Basin Region', 'Upper Colorado Region', 
             'Rio Grande Region')
west <- filter(hu2, HU2_NAME %in% west_pl) %>% 
  st_transform(4326)

west10 <- hu10[st_intersects(hu10, st_union(west)) %>% lengths > 0, ]
```


```{r overlay with western mtns}

mtns_west <- mtns[st_intersects(mtns, st_union(west)) %>% lengths > 0, ]
west10 <- st_crop(west10, mtns_west)
west10_er <- rmapshaper::ms_erase(west10, mtns_west)

ggplot() + 
  geom_sf(data = west10) +
  geom_sf(data = mtns_west, fill = 'purple', alpha = 0.3)
```

**First two authors in alphabetical order**
